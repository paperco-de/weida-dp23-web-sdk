var imgSrc =
    'data:image/png;base64,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';
/**
 * @type {import("../../lib/dtpweb").DTPWeb}
 */
var api = dtpweb.DTPWeb.getInstance();
//
window.onload = function () {
    // Check whether the printing interface is available
    api.checkPlugin(function (success) {
        if (success) {
            // Search for Printers
            // api.discoveryPrinters();
            // // Update printer list after 3 seconds
            // setTimeout(function() {
                updatePrinterList();
            // }, 1000);
        } else {
            api = undefined;
            alert('Printer plugin not detected!');
        }
    });
    // Related UI response processing function
    document.getElementById('select-printlist').onchange = function () {
        onPrinterChanged();
    };
    document.getElementById('select-gaptype').onchange = function () {
        onGapTypeChanged();
    };
    document.getElementById('select-printspeed').onchange = function () {
        onPrintSpeedChanged();
    };
    document.getElementById('select-printdarkness').onchange = function () {
        onPrintDarknessChanged();
    };
    //
    document.getElementById('test-open-printer').onclick = function () {
        onOpenPrinter();
    };
    document.getElementById('test-close-printer').onclick = function () {
        onClosePrinter();
    };
    document.getElementById('test-is-printer-opened').onclick = function () {
        onIsPrinterOpened();
    };
    document.getElementById('test-get-printer-name').onclick = function () {
        onGetPrinterName();
    };
    document.getElementById('test-show-property').onclick = function () {
        onShowProperty();
    };
    //
    document.getElementById('test-draw-text').onclick = function () {
        drawTextTest();
    };
    document.getElementById('test-alignment').onclick = function () {
        drawItemAlignmentTest();
    };
    document.getElementById('test-rotation').onclick = function () {
        drawItemRotationTest();
    };
    document.getElementById('test-draw-barcode').onclick = function () {
        drawBarcodeTest();
    };
    document.getElementById('test-draw-qrcode').onclick = function () {
        drawQRCodeTest();
    };
    document.getElementById('test-draw-pdf417').onclick = function () {
        drawPDF417Test();
    };
    document.getElementById('test-draw-dtmx').onclick = function () {
        drawDataMatrixTest();
    };
    document.getElementById('test-draw-rect').onclick = function () {
        drawRectTest();
    };
    document.getElementById('test-draw-ellipse').onclick = function () {
        drawEllipseTest();
    };
    document.getElementById('test-draw-circle').onclick = function () {
        drawCircleTest();
    };
    document.getElementById('test-draw-line').onclick = function () {
        drawLineTest();
    };
    document.getElementById('test-draw-image-url').onclick = function () {
        drawImageUrlTest();
    };
    document.getElementById('test-draw-image-data').onclick = function () {
        drawImageDataTest();
    };
    document.getElementById('test-draw-ticket').onclick = function () {
        drawTicketTest();
    };
    document.getElementById('test-print-image-data').onclick = function () {
        printImageDataTest();
    };
    document.getElementById('test-print-json').onclick = function () {
        printJsonTest();
    };
};

//#region Get a list of printers

/**
 * Update the printer list.
 */
async function updatePrinterList() {
    var printerElements = document.getElementById('select-printlist');

    // In order to avoid the problem of incomplete data printing during printing, the js interface uses the ajax synchronous request method;
    // In order to avoid a false dead state when calling the interface when the service is not open, it is best to check whether the URL is available before calling it in the appropriate place;
    if (api) {
        var printers = await api.getPrinters({ onlyLocal: false });
        // Clear the current printer list first
        printerElements.innerHTML = '';
        // Re-add the printer list
        if (printers instanceof Array && printers.length > 0) {
            for (var i = 0; i < printers.length; i++) {
                var item = printers[i];
                // If other printers in the LAN are detected, the IP and hostname can be obtained. If it is a local printer, there is only the name attribute in the parameter, which indicates the printer name.
                var name = item.hostname && item.type !== 1 ? item.name + '@' + item.hostname : item.name;
                var value = item.ip ? item.name + '@' + item.ip : item.name;
                printerElements.options.add(new Option(name, value));
            }
        } else {
            printerElements.options.add(new Option('Printer not detected', ''));
        }
        // Link the default printer and update the printing parameters of the selected printer;
        // onPrinterChanged();
    }
}

/**
 * Get the currently selected printer;
 */
function getCurrPrinter() {
    var printerElement = document.getElementById('select-printlist');
    if (!printerElement.value) return {};

    var arr = printerElement.value.split('@');
    return {
        printerName: arr[0],
        ip: arr[1],
    };
}

//#endregion

/**
 * Open the current printer;
 */
async function openPrinter() {
    var printer = getCurrPrinter();
    if (!printer.printerName || !api) return false;
    //
    return api.openPrinter(printer);
}

async function onOpenPrinter() {
    var printer = getCurrPrinter();
    if (!printer.printerName) {
        alert('Printer not detected');
        return false;
    }
    if (await api.openPrinter(printer)) {
        alert('Printer opened successfully');
    } else {
        alert('Printer open failed');
    }
}

/**
 * Turn off the connected printer;
 */
async function onClosePrinter() {
    api.closePrinter();
}

/**
 * When the printer is updated, the relevant printing parameters of the current printer are updated synchronously;
 */
async function onPrinterChanged() {
    if (await openPrinter()) {
        var gapTypeSelect = document.getElementById('select-gaptype');
        gapTypeSelect.value = await api.getGapType();

        var printSpeed = document.getElementById('select-printspeed');
        printSpeed.value = await api.getPrintSpeed();

        var printDarkness = document.getElementById('select-printdarkness');
        printDarkness.value = await api.getPrintDarkness();
    }
    // After use, turn off the printer to avoid occupying the printer and affecting other users' use;
    api.closePrinter();
}

/**
 * Modify the paper type of the current printer;
 * The call is valid after the printer is opened successfully;
 */
function onGapTypeChanged() {
    var gapTypeSelect = document.getElementById('select-gaptype');
    api.setGapType(gapTypeSelect.value);
}

/**
 * Modify the printing speed of the current printer;
 * The call is valid after the printer is opened successfully;
 */
function onPrintSpeedChanged() {
    var printSpeed = document.getElementById('select-printspeed');
    api.setPrintSpeed(printSpeed.value);
}

/**
 * Modify the print density of the currently selected printer;
 * The call is valid after the printer is opened successfully;
 */
function onPrintDarknessChanged() {
    var printDarkness = document.getElementById('select-printdarkness');
    api.setPrintDarkness(printDarkness.value);
}

/**
 * Get the currently selected task type value;
 * 0 : Indicates that the current print task is a print task;
 * 1 : Indicates that the current print task is a white background preview task;
 * 2 : Indicates that the current print task is a preview task with a transparent background;
 */
function getJobTypeValue() {
    return document.getElementById('select-print-preview').value;
}

/**
 * Get the name of the current print task;
 */
function getJobName(jobTypeValue, defJobName) {
    var value = typeof jobTypeValue === 'number' ? jobTypeValue : getJobTypeValue();
    if (value === '1')
        // White base color
        return '#!#Preview#!#';
    else if (value === '2')
        // Transparent background
        return '#!#Transparent#!#';
    else return defJobName || 'DTPWeb'; // Print the task name, just write it;
}
function getJobAction() {
    var value = typeof jobTypeValue === 'number' ? jobTypeValue : getJobTypeValue();
    if (value === '1') return 0x02;
    else if (value === '2') return 0x82;
    else return 0x1000;
}
/**
 * Determine whether the current task is a print task.
 * true : Indicates that the current task is a print task;
 * false: Indicates that the current task is a preview task;
 */
function isPrintJob() {
    var jobType = getJobTypeValue();
    return jobType !== '1' && jobType !== '2';
}

/**
 * Print line related objects.
 */
async function drawLineTest() {
    // Turn on the printer
    if (isPrintJob() && !(await openPrinter())) return;

    var width = 45;
    var lineSpace = 5;
    var height = lineSpace * 4;
    var orientation = document.getElementById('select-orientation').value * 90;
    var jobName = getJobName();
    var lineWidth = 0.5;

    // Start printing task;
    if (await api.startJob({ width: width, height: height, orientation: orientation, jobName: jobName })) {
        //
        await api.drawLine({ y1: 5, x2: 45, y2: 5, lineWidth: lineWidth });
        await api.drawLine({ y1: 10, x2: 45, y2: 10, lineWidth: lineWidth, dashLens: [0.5] });
        await api.drawLine({ y1: 15, x2: 45, y2: 15, lineWidth: lineWidth, dashLens: [0.75, 0.5] });
        // Submit the print job;
        await api.commitJob();

        // Display the preview effect
        await showJobPages();
    }
    //
    await api.closePrinter();
}

/**
 * Prints the rectangle related objects.
 */
async function drawRectTest() {
    // Turn on the printer
    if (isPrintJob() && !(await openPrinter())) return;

    var width = 45;
    var height = 30;
    var orientation = document.getElementById('select-orientation').value * 90;
    var jobName = getJobName();
    var padding = 2;

    // Creating a print job
    if (await api.startJob({ width: width, height: height, orientation: orientation, jobName: jobName })) {
        await api.startPage();
        // First page, print rectangle
        await api.drawRectangle({ width: width, height: height });
        // Print filled rectangle
        await api.drawRectangle({
            x: padding,
            y: padding,
            width: width - padding * 2,
            height: height - padding * 2,
            fill: true,
        });
        await api.endPage();

        // On the second page, print the rounded rectangle frame
        await api.startPage();
        await api.drawRectangle({
            width: width,
            height: height,
            cornerWidth: 3.0,
            cornerHeight: 3.0,
            lineWidth: 0.5,
        });
        await api.drawRectangle({
            x: padding,
            y: padding,
            width: width - padding * 2,
            height: height - padding * 2,
            cornerWidth: 2,
            cornerHeight: 2,
            fill: true,
        });
        await api.endPage();

        // Submit a print job
        await api.commitJob();

        // Display the preview effect
        await showJobPages();
    }
    //
    await api.closePrinter();
}

/**
 * Print ellipse related objects.
 */
async function drawEllipseTest() {
    // Turn on the printer
    if (isPrintJob() && !(await openPrinter())) return;

    var width = 45;
    var height = 30;
    var orientation = document.getElementById('select-orientation').value * 90;
    var jobName = getJobName();
    var padding = 2;

    // Create a print job.
    if (await api.startJob({ width: width, height: height, orientation: orientation, jobName: jobName })) {
        // Print ellipse border
        await api.drawEllipse({ width: width, height: height, lineWidth: 0.5 });
        // Print filled ellipse
        await api.drawEllipse({
            x: padding,
            y: padding,
            width: width - padding * 2,
            height: height - padding * 2,
            fill: true,
        });

        // Submit the print job.
        await api.commitJob();

        // Display the preview effect
        await showJobPages();
    }
    //
    await api.closePrinter();
}

/**
 * Print ellipse related objects.
 */
async function drawCircleTest() {
    // Turn on the printer
    if (isPrintJob() && !(await openPrinter())) return;

    var width = 30;
    var height = 30;
    var centerX = 15;
    var centerY = 15;
    var radius = 15;
    var orientation = document.getElementById('select-orientation').value * 90;
    var jobName = getJobName();
    var padding = 2;

    // Create a print job.
    if (await api.startJob({ width: width, height: height, orientation: orientation, jobName: jobName })) {
        // Print ellipse border
        await api.drawCircle({ x: centerX, y: centerY, radius: radius });
        // Print filled ellipse
        await api.drawCircle({ x: centerX, y: centerY, radius: radius - padding, fill: true });

        // Submit the print job.
        await api.commitJob();

        // Display the preview effect
        await showJobPages();
    }
    //
    await api.closePrinter();
}

/**
 * Print text related objects.
 */
async function drawTextTest() {
    // Turn on the printer
    if (isPrintJob() && !(await openPrinter())) return;

    var width = 40;
    var height = 30;
    var orientation = document.getElementById('select-orientation').value * 90;
    var jobName = getJobName();
    var fontHeight = 5;
    var text = '@Shanghai Daozhen Information Technology Co., Ltd.#';
    // var text = "www.dothatnech.com";

    if (await api.startJob({ width: width, height: height, orientation: orientation, jobName: jobName })) {
        //
        await api.drawText({ text: text, width: width, height: height, fontHeight: fontHeight });
        //
        await api.commitJob();

        // Display the preview effect
        await showJobPages();
    }
    //
    await api.closePrinter();
}

/**
 * Draw a 1D code.
 */
async function drawBarcodeTest() {
    // Turn on the printer
    if (isPrintJob() && !(await openPrinter())) return;

    var width = 45;
    var height = 30;
    var orientation = document.getElementById('select-orientation').value * 90;
    var jobName = getJobName();
    var text = '1234567890';
    var margin = 5;

    if (await api.startJob({ width: width, height: height, orientation: orientation, jobName: jobName })) {
        //
        await api.draw1DBarcode({
            text: text,
            x: margin,
            y: margin,
            width: width - margin * 2,
            height: height - margin * 2,
            textHeight: 5,
        });
        await api.commitJob();

        // Display the preview effect
        await showJobPages();
    }
    //
    await api.closePrinter();
}

/**
 * Draw a QR code.
 */
async function drawQRCodeTest() {
    // Turn on the printer
    if (isPrintJob() && !(await openPrinter())) return;

    var width = 45;
    var height = 45;
    var orientation = document.getElementById('select-orientation').value * 90;
    var jobName = getJobName();
    var margin = 5;
    var text = 'Shanghai Daozhen Information Technology Co., Ltd.';
    // var text = "www.dothantech.com";

    if (await api.startJob({ width: width, height: height, orientation: orientation, jobName: jobName })) {
        //
        await api.draw2DQRCode({
            text: text,
            x: margin,
            y: margin,
            width: width - margin * 2,
        });
        await api.commitJob();

        // Display the preview effect
        await showJobPages();
    }
    //
    await api.closePrinter();
}

/**
 * Print PDF417.
 */
async function drawPDF417Test() {
    // Turn on the printer
    if (isPrintJob() && !(await openPrinter())) return;

    var width = 45;
    var height = 30;
    var orientation = document.getElementById('select-orientation').value * 90;
    var jobName = getJobName();
    var text = 'Shanghai Daozhen Information Technology Co., Ltd.';
    // var text = "www.dothantech.com";
    var margin = 5;

    if (await api.startJob({ width: width, height: height, orientation: orientation, jobName: jobName })) {
        //
        await api.draw2DPdf417({
            text: text,
            x: margin,
            y: margin,
            width: width - margin * 2,
            height: height - margin * 2,
        });

        await api.commitJob();

        // Display the preview effect
        await showJobPages();
    }
    //
    await api.closePrinter();
}

async function drawDataMatrixTest() {
    // Turn on the printer
    if (isPrintJob() && !(await openPrinter())) return;

    var width = 40;
    var height = 40;
    var orientation = document.getElementById('select-orientation').value * 90;
    var jobName = getJobName();
    // var text = 'Shanghai Daozhen Information Technology Co., Ltd.';
    var text = "www.dothantech.com";
    var margin = 5;

    if (await api.startJob({ width: width, height: height, orientation: orientation, jobName: jobName })) {
        //
        await api.draw2DDataMatrix({
            text: text,
            x: margin,
            y: margin,
            width: width - margin * 2,
            height: height - margin * 2,
        });

        await api.commitJob();

        // Display the preview effect
        await showJobPages();
    }
    //
    await api.closePrinter();
}

/**
 * Print network pictures.
 */
async function drawImageUrlTest() {
    // Turn on the printer
    if (isPrintJob() && !(await openPrinter())) return;

    var width = 30;
    var height = 30;
    var orientation = document.getElementById('select-orientation').value * 90;
    var jobName = getJobName();
    var url = 'http://www.detonger.com/img/QRCode_OfficialAccounts.png';
    var margin = 5;
    if (await api.startJob({ width: width, height: height, orientation: orientation, jobName: jobName })) {
        //
        await api.drawImage({
            imageFile: url,
            x: margin,
            y: margin,
            width: width - margin * 2,
            height: height - margin * 2,
        });
        await api.commitJob();

        // Display the preview effect
        await showJobPages();
    }
    //
    await api.closePrinter();
}

async function drawImageDataTest() {
    // Turn on the printer
    if (isPrintJob() && !(await openPrinter())) return;

    var labelWidth = 30;
    var labelHeight = 30;
    var orientation = document.getElementById('select-orientation').value * 90;
    var jobName = getJobName();

    if (await api.startJob({ width: labelWidth, height: labelHeight, orientation: orientation, jobName: jobName })) {
        //
        await api.drawImageD({
            data: imgSrc,
            drawWidth: labelWidth,
            drawHeight: labelHeight,
        });
        await api.commitJob();

        // Display the preview effect
        await showJobPages();
    }
    //
    await api.closePrinter();
}
async function drawItemAlignmentTest() {
    // Turn on the printer
    if (isPrintJob() && !(await openPrinter())) return;

    var width = 45;
    var height = 40;
    var orientation = document.getElementById('select-orientation').value * 90;
    var jobName = getJobName();
    var fontHeight = 4;
    var itemWidth = width / 2;
    var itemHeight = height / 2;
    var text1 = 'Align horizontally to the left and vertically to the top';
    var text2 = 'Horizontal center alignment, vertical center alignment';
    var text3 = 'Align right horizontally and bottom vertically';
    var text4 = 'Horizontal stretch alignment, vertical stretch alignment';

    if (await api.startJob({ width: width, height: height, orientation: orientation, jobName: jobName })) {
        // Divide the main label into four areas, corresponding to different alignment methods
        await api.drawRectangle({ width: width, height: height });
        await api.drawLine({ x1: 0, x2: width, y1: itemHeight });
        await api.drawLine({ y1: 0, y2: height, x1: itemWidth });
        // Left-align, top-align
        await api.drawText({
            text: text1,
            x: 0,
            y: 0,
            width: itemWidth,
            height: itemHeight,
            fontHeight: fontHeight,
            horizontalAlignment: 0,
            verticalAlignment: 0,
        });
        // Horizontally center, vertically center
        await api.drawText({
            text: text2,
            x: itemWidth,
            y: 0,
            width: itemWidth,
            height: itemHeight,
            fontHeight: fontHeight,
            horizontalAlignment: 1,
            verticalAlignment: 1,
        });
        // Horizontally right, vertically right
        await api.drawText({
            text: text3,
            x: itemWidth,
            y: itemHeight,
            width: itemWidth,
            height: itemHeight,
            fontHeight: fontHeight,
            horizontalAlignment: 2,
            verticalAlignment: 2,
        });
        // Horizontal stretch, vertical stretch
        await api.drawText({
            text: text4,
            x: 0,
            y: itemHeight,
            width: itemWidth,
            height: itemHeight,
            fontHeight: fontHeight,
            horizontalAlignment: 3,
            verticalAlignment: 3,
        });
        //
        await api.commitJob();

        // Display the preview effect
        await showJobPages();
    }
    //
    await api.closePrinter();
}
async function drawItemRotationTest() {
    // Turn on the printer
    if (isPrintJob() && !(await openPrinter())) return;

    var width = 45;
    var height = 40;
    var orientation = document.getElementById('select-orientation').value * 90;
    var jobName = getJobName();
    var fontHeight = 4;
    var text = '@Shanghai Daozhen Information Technology Co., Ltd.#';
    // var text = "www.dothatnech.com";
    var itemWidth = width / 2;
    var itemHeight = height / 2;

    if (await api.startJob({ width: width, height: height, orientation: orientation, jobName: jobName })) {
        // Divide the main label into four areas, corresponding to different alignment methods
        await api.drawRectangle({ width: width, height: height });
        await api.drawLine({ x1: 0, x2: width, y1: itemHeight });
        await api.drawLine({ y1: 0, y2: height, x1: itemWidth });
        // Left-align, top-align
        await api.drawText({
            text: text,
            x: 0,
            y: 0,
            width: itemWidth,
            height: itemHeight,
            fontHeight: fontHeight,
            orientation: 0,
        });
        // Horizontally center, vertically center
        await api.drawText({
            text: text,
            x: itemWidth,
            y: 0,
            width: itemWidth,
            height: itemHeight,
            fontHeight: fontHeight,
            orientation: 90,
        });
        // Horizontally right, vertically right
        await api.drawText({
            text: text,
            x: itemWidth,
            y: itemHeight,
            width: itemWidth,
            height: itemHeight,
            fontHeight: fontHeight,
            orientation: 180,
        });
        // Horizontal stretch, vertical stretch
        await api.drawText({
            text: text,
            x: 0,
            y: itemHeight,
            width: itemWidth,
            height: itemHeight,
            fontHeight: fontHeight,
            orientation: 270,
        });
        //
        await api.commitJob();

        // Display the preview effect
        await showJobPages();
    }
    //
    await api.closePrinter();
}
/**
 * Receipt paper printing scenario demonstration.
 */
async function drawTicketTest() {
    console.log('### print ticket ###');
}

/**
 * Directly print BASE64 image test.
 */
async function printImageDataTest() {
    var printer = getCurrPrinter();
    var printerName = printer.printerName || printer.name;
    //
    if (!api || !printerName) return;
    //
    var datas = getPreviewList();
    for (var i = 0; i < datas.length; i++) {
        if (datas[i].src) {
            await api.printImage({
                data: datas[i].src,
                printerName: printerName,
            });
        }
    }
}
/**
 * JSON format data printing test.
 */
async function printJsonTest() {
    var printer = getCurrPrinter();
    var printerName = printer ? printer.printerName : undefined;
    if (isPrintJob() && !printerName) return;
    //
    var printAction = getJobAction();
    var labelWidth = 40;
    var labelHeight = 30;
    // var url = 'http://www.detonger.com/img/QRCode_OfficialAccounts.png';
    // var text1 = 'Shanghai Daozhen Information Technology Co., Ltd.';
    // var text2 = '1234567';
    //
    const results = await api.print({
        action: printAction,
        printerInfo: {
            printerName: printer.printerName,
        },
        jobInfo: { jobWidth: labelWidth, jobHeight: labelHeight, orientation: 0 },
        jobPages: [
            // The first label, put a QR code inside the outer frame
            [
                { type: 'rectangle', width: labelWidth, height: labelHeight, lineWidth: 0.4 },
                // { type: 'roundRectangle', width: labelWidth, height: labelHeight, lineWidth: 0.4, cornerWidth: 2 },
                // { type: 'text', text: text1, width: labelWidth, height: labelHeight, fontHeight: 4 },
                {
                    type: 'barcode',
                    text: '12345678',
                    x: 5,
                    y: 5,
                    width: 30,
                    height: 20,
                    textHeight: 4,
                    textAlignment: 3,
                },
                // { type: 'qrcode', text: text1, x: 10, y: 5, width: 20, eccLevel: 1 },
                // { type: 'pdf417', text: text2, x: 5, y: 5, width: 30, height: 20 },
                // // Draw the image url
                // { type: 'image', imageFile: url, x: 10, y: 5, width: 20, height: 20 },
                // // Draw a BASE64 string
                // { type: 'image', imageFile: imgSrc, x: 10, y: 5, width: 20, height: 20 },
                // { type: 'line', x1: 0, y1: 5, x2: labelWidth, y2: 5, lineWidth: 0.4 },
                // { type: 'dashLine', x1: 0, y1: 10, x2: labelWidth, y2: 10, lineWidth: 0.4, dashLen: '1,0.5' },
            ],
        ],
    });
    // Show preview effect
    if (printAction !== 0x1000 && results) {
        await showJobPages(results.previewData);
    }
}

// Printer attribute judgment

async function onGetPrinterName() {
    if (!(await api.isPrinterOpened())) {
        alert('The printer is not turned on');
        return false;
    }
    //
    alert(await api.getPrinterName());
}

async function onIsPrinterOpened() {
    alert(await api.isPrinterOpened());
}

var toggleTag = false;
/**
 * Open the printer properties and test the box;
 */
async function onShowProperty() {
    var printer = getCurrPrinter();
    if (!printer) {
        alert('Printer not detected');
        return;
    }
    api.showProperty({
        showDocument: toggleTag,
        printerName: printer.printerName,
    });
    // Switch the toggle state and test whether showDocument is true or false;
    toggleTag = !toggleTag;
}

//#region Print task test

/**
 * Get the image information of the current task;
 */
async function showJobPages(pages) {
    // Clear the preview area first;
    clearPreview();
    //
    if (pages && pages.length > 0) {
        for (var i = 0; i < pages.length; i++) {
            addPreview(pages[i]);
        }
    } else {
        // If you need to display all labels in the print task, you need to check the number of labels first.
        var info = await api.getPageInfo();
        // Traverse all page data and add them to the preview area
        if (info) {
            for (var i = 0; i < info.pages; i++) {
                var page = await api.getPageImage({ page: i });
                addPreview(page.data);
            }
        }
    }
}

/**
 * Clear the preview area;
 */
function clearPreview() {
    document.getElementById('preview-list').innerHTML = '';
}

/**
 * Add preview pictures to the item preview area;
 */
function addPreview(data) {
    if (!data) return;

    var previewGroup = document.getElementById('preview-list');
    var img = document.createElement('img');
    img.src = data;
    previewGroup.appendChild(img);
    // 换行
    previewGroup.appendChild(document.createElement('br'));
}

/**
 * 获取 #preview-list中所有img的src；
 */
function getPreviewList() {
    var previewGroup = document.getElementById('preview-list');
    var pageList = [];
    for (var i = 0; i < previewGroup.children.length; i++) {
        var imgElement = previewGroup.children[i];
        pageList.push(imgElement);
    }

    return pageList;
}

//#endregion
